{"ast":null,"code":"import _regeneratorRuntime from\"/Users/deborahketema/Downloads/jvlcart-main/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/deborahketema/Downloads/jvlcart-main/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{useElements,useStripe}from\"@stripe/react-stripe-js\";import{CardNumberElement,CardExpiryElement,CardCvcElement}from\"@stripe/react-stripe-js\";import axios from\"axios\";import{useEffect}from\"react\";import{useDispatch,useSelector}from'react-redux';import{useNavigate}from'react-router-dom';import{toast}from\"react-toastify\";import{orderCompleted}from\"../../slices/cartSlice\";import{validateShipping}from'../cart/Shipping';import{createOrder}from'../../actions/orderActions';import{clearError as clearOrderError}from\"../../slices/orderSlice\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Payment(){var stripe=useStripe();var elements=useElements();var dispatch=useDispatch();var navigate=useNavigate();var orderInfo=JSON.parse(sessionStorage.getItem('orderInfo'));var _useSelector=useSelector(function(state){return state.authState;}),user=_useSelector.user;var _useSelector2=useSelector(function(state){return state.cartState;}),cartItems=_useSelector2.items,shippingInfo=_useSelector2.shippingInfo;var _useSelector3=useSelector(function(state){return state.orderState;}),orderError=_useSelector3.error;var paymentData={amount:Math.round(orderInfo.totalPrice*100),shipping:{name:user.name,address:{city:shippingInfo.city,postal_code:shippingInfo.postalCode,country:shippingInfo.country,state:shippingInfo.state,line1:shippingInfo.address},phone:shippingInfo.phoneNo}};var order={orderItems:cartItems,shippingInfo:shippingInfo};if(orderInfo){order.itemsPrice=orderInfo.itemsPrice;order.shippingPrice=orderInfo.shippingPrice;order.taxPrice=orderInfo.taxPrice;order.totalPrice=orderInfo.totalPrice;}useEffect(function(){validateShipping(shippingInfo,navigate);if(orderError){toast(orderError,{position:toast.POSITION.BOTTOM_CENTER,type:'error',onOpen:function onOpen(){dispatch(clearOrderError());}});return;}},[]);var submitHandler=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var _yield$axios$post,data,clientSecret,result;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();document.querySelector('#pay_btn').disabled=true;_context.prev=2;_context.next=5;return axios.post('/api/v1/payment/process',paymentData);case 5:_yield$axios$post=_context.sent;data=_yield$axios$post.data;clientSecret=data.client_secret;_context.next=10;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardNumberElement),billing_details:{name:user.name,email:user.email}}});case 10:result=_context.sent;if(!result.error){_context.next=16;break;}toast(result.error.message,{type:'error',position:toast.POSITION.BOTTOM_CENTER});document.querySelector('#pay_btn').disabled=false;_context.next=28;break;case 16:_context.next=18;return result;case 18:_context.t0=_context.sent.paymentIntent.status;if(!(_context.t0==='succeeded')){_context.next=27;break;}toast('Payment Success!',{type:'success',position:toast.POSITION.BOTTOM_CENTER});order.paymentInfo={id:result.paymentIntent.id,status:result.paymentIntent.status};dispatch(orderCompleted());dispatch(createOrder(order));navigate('/order/success');_context.next=28;break;case 27:toast('Please Try again!',{type:'warning',position:toast.POSITION.BOTTOM_CENTER});case 28:_context.next=32;break;case 30:_context.prev=30;_context.t1=_context[\"catch\"](2);case 32:case\"end\":return _context.stop();}},_callee,null,[[2,30]]);}));return function submitHandler(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{className:\"row wrapper\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-10 col-lg-5\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:submitHandler,className:\"shadow-lg\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"mb-4\",children:\"Card Info\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card_num_field\",children:\"Card Number\"}),/*#__PURE__*/_jsx(CardNumberElement,{type:\"text\",id:\"card_num_field\",className:\"form-control\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card_exp_field\",children:\"Card Expiry\"}),/*#__PURE__*/_jsx(CardExpiryElement,{type:\"text\",id:\"card_exp_field\",className:\"form-control\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card_cvc_field\",children:\"Card CVC\"}),/*#__PURE__*/_jsx(CardCvcElement,{type:\"text\",id:\"card_cvc_field\",className:\"form-control\",value:\"\"})]}),/*#__PURE__*/_jsxs(\"button\",{id:\"pay_btn\",type:\"submit\",className:\"btn btn-block py-3\",children:[\"Pay - \",\" $\".concat(orderInfo&&orderInfo.totalPrice)]})]})})});}","map":{"version":3,"names":["useElements","useStripe","CardNumberElement","CardExpiryElement","CardCvcElement","axios","useEffect","useDispatch","useSelector","useNavigate","toast","orderCompleted","validateShipping","createOrder","clearError","clearOrderError","Payment","stripe","elements","dispatch","navigate","orderInfo","JSON","parse","sessionStorage","getItem","state","authState","user","cartState","cartItems","items","shippingInfo","orderState","orderError","error","paymentData","amount","Math","round","totalPrice","shipping","name","address","city","postal_code","postalCode","country","line1","phone","phoneNo","order","orderItems","itemsPrice","shippingPrice","taxPrice","position","POSITION","BOTTOM_CENTER","type","onOpen","submitHandler","e","preventDefault","document","querySelector","disabled","post","data","clientSecret","client_secret","confirmCardPayment","payment_method","card","getElement","billing_details","email","result","message","paymentIntent","status","paymentInfo","id"],"sources":["/Users/deborahketema/Downloads/jvlcart-main/frontend/src/components/cart/Payment.js"],"sourcesContent":["import { useElements, useStripe } from \"@stripe/react-stripe-js\"\nimport { CardNumberElement, CardExpiryElement, CardCvcElement } from \"@stripe/react-stripe-js\";\nimport axios from \"axios\";\nimport { useEffect } from \"react\";\nimport {useDispatch, useSelector} from 'react-redux';\nimport {useNavigate} from 'react-router-dom'\nimport { toast } from \"react-toastify\";\nimport { orderCompleted } from \"../../slices/cartSlice\";\nimport {validateShipping} from '../cart/Shipping';\nimport {createOrder} from '../../actions/orderActions'\nimport { clearError as clearOrderError } from \"../../slices/orderSlice\";\n\nexport default function Payment() {\n    const stripe = useStripe();\n    const elements = useElements();\n    const dispatch = useDispatch()\n    const navigate = useNavigate();\n    const orderInfo = JSON.parse(sessionStorage.getItem('orderInfo'))\n    const { user } = useSelector(state => state.authState)\n    const {items:cartItems, shippingInfo } = useSelector(state => state.cartState)\n    const { error:orderError } = useSelector(state => state.orderState)\n\n    const paymentData = {\n        amount : Math.round( orderInfo.totalPrice * 100),\n        shipping :{\n            name: user.name,\n            address:{\n                city: shippingInfo.city,\n                postal_code : shippingInfo.postalCode,\n                country: shippingInfo.country,\n                state: shippingInfo.state,\n                line1 : shippingInfo.address\n            },\n            phone: shippingInfo.phoneNo\n        }\n    }\n\n    const order = {\n        orderItems: cartItems,\n        shippingInfo\n    }\n\n    if(orderInfo) {\n        order.itemsPrice = orderInfo.itemsPrice\n        order.shippingPrice = orderInfo.shippingPrice\n        order.taxPrice = orderInfo.taxPrice\n        order.totalPrice = orderInfo.totalPrice\n        \n    }\n\n    useEffect(() => {\n        validateShipping(shippingInfo, navigate)\n        if(orderError) {\n            toast(orderError, {\n                position: toast.POSITION.BOTTOM_CENTER,\n                type: 'error',\n                onOpen: ()=> { dispatch(clearOrderError()) }\n            })\n            return\n        }\n\n    },[])\n\n    const submitHandler = async (e) => {\n        e.preventDefault();\n        document.querySelector('#pay_btn').disabled = true;\n        try {\n            const {data} = await axios.post('/api/v1/payment/process', paymentData)\n            const clientSecret = data.client_secret\n            const result = await stripe.confirmCardPayment(clientSecret, {\n                payment_method: {\n                    card: elements.getElement(CardNumberElement),\n                    billing_details: {\n                        name: user.name,\n                        email: user.email\n                    }\n                }\n            })\n\n            if(result.error){\n                toast(result.error.message, {\n                    type: 'error',\n                    position: toast.POSITION.BOTTOM_CENTER\n                })\n                document.querySelector('#pay_btn').disabled = false;\n            }else{\n                if((await result).paymentIntent.status === 'succeeded') {\n                    toast('Payment Success!', {\n                        type: 'success',\n                        position: toast.POSITION.BOTTOM_CENTER\n                    })\n                    order.paymentInfo = {\n                        id: result.paymentIntent.id,\n                        status: result.paymentIntent.status\n                    }\n                    dispatch(orderCompleted())\n                    dispatch(createOrder(order))\n\n                    navigate('/order/success')\n                }else{\n                    toast('Please Try again!', {\n                        type: 'warning',\n                        position: toast.POSITION.BOTTOM_CENTER\n                    })\n                }\n            }\n\n\n        } catch (error) {\n            \n        }\n    }\n\n\n     return (\n        <div className=\"row wrapper\">\n            <div className=\"col-10 col-lg-5\">\n                <form onSubmit={submitHandler} className=\"shadow-lg\">\n                    <h1 className=\"mb-4\">Card Info</h1>\n                    <div className=\"form-group\">\n                    <label htmlFor=\"card_num_field\">Card Number</label>\n                    <CardNumberElement\n                        type=\"text\"\n                        id=\"card_num_field\"\n                        className=\"form-control\"\n                       \n                    />\n                    </div>\n                    \n                    <div className=\"form-group\">\n                    <label htmlFor=\"card_exp_field\">Card Expiry</label>\n                    <CardExpiryElement\n                        type=\"text\"\n                        id=\"card_exp_field\"\n                        className=\"form-control\"\n                       \n                    />\n                    </div>\n                    \n                    <div className=\"form-group\">\n                    <label htmlFor=\"card_cvc_field\">Card CVC</label>\n                    <CardCvcElement\n                        type=\"text\"\n                        id=\"card_cvc_field\"\n                        className=\"form-control\"\n                        value=\"\"\n                    />\n                    </div>\n        \n                \n                    <button\n                    id=\"pay_btn\"\n                    type=\"submit\"\n                    className=\"btn btn-block py-3\"\n                    >\n                    Pay - { ` $${orderInfo && orderInfo.totalPrice}` }\n                    </button>\n        \n                </form>\n            </div>\n        </div>\n    )\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}